<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patient Portal</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            margin: 20px;
        }

        .hidden {
            display: none !important;
        }

        /* Login Screen */
        .login-screen {
            padding: 60px;
            text-align: center;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }

        .login-form {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .login-form h2 {
            margin-bottom: 30px;
            color: #333;
            font-size: 28px;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            color: #333;
        }

        .link-btn {
            background: none;
            color: #667eea;
            text-decoration: underline;
            border: none;
            cursor: pointer;
            font-size: 14px;
        }

        /* Dashboard */
        .dashboard {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 250px;
            background: linear-gradient(180deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px 0;
        }

        .sidebar h3 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 24px;
        }

        .sidebar ul {
            list-style: none;
        }

        .sidebar li {
            padding: 15px 30px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .sidebar li:hover, .sidebar li.active {
            background-color: rgba(255,255,255,0.1);
        }

        .main-content {
            flex: 1;
            padding: 40px;
            background: #f8f9fa;
            position: relative;
        }

        .section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .section h2 {
            margin-bottom: 20px;
            color: #2c3e50;
            font-size: 24px;
        }

        /* Appointments */
        .appointment-card {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .appointment-status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }

        .status-pending {
            background: #f39c12;
        }

        .status-approved {
            background: #27ae60;
        }

        .status-denied {
            background: #e74c3c;
        }

        /* Mental Health Tests */
        .test-card {
            background: linear-gradient(135deg, #a29bfe 0%, #6c5ce7 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .test-card:hover {
            transform: translateY(-3px);
        }

        .question {
            margin-bottom: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .question h4 {
            margin-bottom: 15px;
            color: #2c3e50;
        }

        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: white;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .radio-option:hover {
            background: #e9ecef;
        }

        .test-result {
            background: linear-gradient(135deg, #00b894 0%, #00a085 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        /* Admin specific styles */
        .admin-card {
            background: linear-gradient(135deg, #fd79a8 0%, #e84393 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .action-buttons {
            margin-top: 15px;
        }

        .btn-approve {
            background: #27ae60;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 10px;
        }

        .btn-deny {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
        }

        .logout-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #e74c3c;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
        }

        .alert {
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            font-weight: bold;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        @media (max-width: 768px) {
            .dashboard {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                padding: 20px 0;
            }
            
            .sidebar ul {
                display: flex;
                overflow-x: auto;
            }
            
            .sidebar li {
                white-space: nowrap;
                min-width: 150px;
            }
            
            .main-content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Login Screen -->
        <div id="loginScreen" class="login-screen">
            <div class="login-form">
                <h2>Patient Portal Login</h2>
                <div id="loginAlert"></div>
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="loginEmail" placeholder="Enter your email">
                </div>
                <div class="form-group">
                    <label>Password:</label>
                    <input type="password" id="loginPassword" placeholder="Enter your password">
                </div>
                <button class="btn" onclick="login()">Login</button>
                <button class="btn btn-secondary" onclick="showSignup()">Create Account</button>
                <button class="link-btn" onclick="showAdminLogin()">Staff Login</button>
            </div>
        </div>

        <!-- Signup Screen -->
        <div id="signupScreen" class="login-screen hidden">
            <div class="login-form">
                <h2>Create Account</h2>
                <div id="signupAlert"></div>
                <div class="form-group">
                    <label>Full Name:</label>
                    <input type="text" id="signupName" placeholder="Enter your full name">
                </div>
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="signupEmail" placeholder="Enter your email">
                </div>
                <div class="form-group">
                    <label>Password:</label>
                    <input type="password" id="signupPassword" placeholder="Create a password">
                </div>
                <div class="form-group">
                    <label>Phone Number:</label>
                    <input type="tel" id="signupPhone" placeholder="Enter your phone number">
                </div>
                <div class="form-group">
                    <label>Gender:</label>
                    <select id="signupGender">
                        <option value="">Select Gender</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                        <option value="other">Other</option>
                        <option value="prefer-not-to-say">Prefer not to say</option>
                    </select>
                </div>
                <button class="btn" onclick="signup()">Create Account</button>
                <button class="link-btn" onclick="showLogin()">Back to Login</button>
            </div>
        </div>

        <!-- Admin Login Screen -->
        <div id="adminLoginScreen" class="login-screen hidden">
            <div class="login-form">
                <h2>Staff Login</h2>
                <div id="adminLoginAlert"></div>
                <div class="form-group">
                    <label>Username:</label>
                    <input type="text" id="adminUsername" placeholder="Enter username">
                </div>
                <div class="form-group">
                    <label>Password:</label>
                    <input type="password" id="adminPassword" placeholder="Enter password">
                </div>
                <button class="btn" onclick="adminLogin()">Login</button>
                <button class="link-btn" onclick="showLogin()">Back to Patient Login</button>
            </div>
        </div>

        <!-- Patient Dashboard -->
        <div id="patientDashboard" class="dashboard hidden">
            <button class="logout-btn" onclick="logout()">Logout</button>
            <div class="sidebar">
                <h3>Patient Portal</h3>
                <ul>
                    <li class="active" onclick="showSection('appointments', event)">Manage Appointments</li>
                    <li onclick="showSection('mentalHealth', event)">Mental Health Tests</li>
                    <li onclick="showSection('healthRecords', event)">Health Records</li>
                    <li onclick="showSection('profile', event)">Profile</li>
                </ul>
            </div>
            <div class="main-content">
                <!-- Appointments Section -->
                <div id="appointmentsSection" class="section">
                    <h2>Manage Appointments</h2>
                    <div id="appointmentsList"></div>
                    <button class="btn" onclick="showBookingForm()">Book New Appointment</button>
                    
                    <!-- Booking Form -->
                    <div id="bookingForm" class="hidden" style="margin-top: 20px; background: #f8f9fa; padding: 20px; border-radius: 10px;">
                        <h3>Book New Appointment</h3>
                        <div class="form-group">
                            <label>Preferred Appointment Time:</label>
                            <select id="appointmentTime">
                                <option value="">Select Time</option>
                                <option value="thursday-1-2pm">Thursday 1-2 PM</option>
                                <option value="friday-1-2pm">Friday 1-2 PM</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Reason for Visit:</label>
                            <textarea id="appointmentReason" placeholder="Please describe the reason for your visit"></textarea>
                        </div>
                        <button class="btn" onclick="bookAppointment()">Submit Request</button>
                        <button class="btn btn-secondary" onclick="hideBookingForm()">Cancel</button>
                    </div>
                </div>

                <!-- Mental Health Tests Section -->
                <div id="mentalHealthSection" class="section hidden">
                    <h2>Mental Health Tests</h2>
                    <div class="test-card" onclick="startTest('depression')">
                        <h3>Depression Screening (PHQ-9)</h3>
                        <p>Take a self-assessment to screen for depression symptoms</p>
                    </div>
                    <div class="test-card" onclick="startTest('anxiety')">
                        <h3>Anxiety Screening (GAD-7)</h3>
                        <p>Take a self-assessment to screen for anxiety symptoms</p>
                    </div>
                    <div class="test-card" onclick="startTest('adhd')">
                        <h3>ADHD Screening</h3>
                        <p>Take a self-assessment to screen for ADHD symptoms</p>
                    </div>
                    <div id="testResults"></div>
                </div>

                <!-- Test Taking Interface -->
                <div id="testInterface" class="section hidden">
                    <h2 id="testTitle"></h2>
                    <div id="testQuestions"></div>
                    <button class="btn" onclick="submitTest()">Submit Test</button>
                    <button class="btn btn-secondary" onclick="cancelTest()">Cancel</button>
                </div>

                <!-- Health Records Section -->
                <div id="healthRecordsSection" class="section hidden">
                    <h2>Health Records</h2>
                    <p>Your health records and medical history will be displayed here.</p>
                    <div id="healthRecordsList"></div>
                </div>

                <!-- Profile Section -->
                <div id="profileSection" class="section hidden">
                    <h2>Profile</h2>
                    <div id="profileInfo"></div>
                </div>
            </div>
        </div>

        <!-- Admin Dashboard -->
        <div id="adminDashboard" class="dashboard hidden">
            <button class="logout-btn" onclick="logout()">Logout</button>
            <div class="sidebar">
                <h3>Admin Portal</h3>
                <ul>
                    <li class="active" onclick="showAdminSection('appointments', event)">Appointment Requests</li>
                    <li onclick="showAdminSection('patients', event)">Patient Management</li>
                    <li onclick="showAdminSection('testResults', event)">Test Results</li>
                </ul>
            </div>
            <div class="main-content">
                <!-- Admin Appointments Section -->
                <div id="adminAppointmentsSection" class="section">
                    <h2>Appointment Requests</h2>
                    <div id="adminAppointmentsList"></div>
                </div>

                <!-- Admin Patients Section -->
                <div id="adminPatientsSection" class="section hidden">
                    <h2>Patient Management</h2>
                    <div id="patientsList"></div>
                </div>

                <!-- Admin Test Results Section -->
                <div id="adminTestResultsSection" class="section hidden">
                    <h2>Patient Test Results</h2>
                    <div id="adminTestResultsList"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // In-memory data storage (replaces Firebase for now)
        let userData = {
            patients: [],
            appointments: [],
            testResults: [],
            currentUser: null,
            isAdmin: false
        };

        // Add some demo data
        userData.patients = [
            {
                id: 1,
                name: "Demo Patient",
                email: "demo@patient.com",
                password: "demo123",
                phone: "555-0123",
                gender: "male"
            }
        ];

        // Admin credentials
        const adminCredentials = {
            username: "admin",
            password: "admin123"
        };

        // Mental health test questions
        const testQuestions = {
            depression: [
                {
                    question: "Little interest or pleasure in doing things",
                    options: ["Not at all", "Several days", "More than half the days", "Nearly every day"]
                },
                {
                    question: "Feeling down, depressed, or hopeless",
                    options: ["Not at all", "Several days", "More than half the days", "Nearly every day"]
                },
                {
                    question: "Trouble falling or staying asleep, or sleeping too much",
                    options: ["Not at all", "Several days", "More than half the days", "Nearly every day"]
                }
            ],
            anxiety: [
                {
                    question: "Feeling nervous, anxious or on edge",
                    options: ["Not at all", "Several days", "More than half the days", "Nearly every day"]
                },
                {
                    question: "Not being able to stop or control worrying",
                    options: ["Not at all", "Several days", "More than half the days", "Nearly every day"]
                },
                {
                    question: "Worrying too much about different things",
                    options: ["Not at all", "Several days", "More than half the days", "Nearly every day"]
                }
            ],
            adhd: [
                {
                    question: "How often do you have trouble wrapping up the final details of a project?",
                    options: ["Never", "Rarely", "Sometimes", "Often", "Very Often"]
                },
                {
                    question: "How often do you have difficulty getting things in order when you have to do a task that requires organization?",
                    options: ["Never", "Rarely", "Sometimes", "Often", "Very Often"]
                },
                {
                    question: "How often do you have problems remembering appointments or obligations?",
                    options: ["Never", "Rarely", "Sometimes", "Often", "Very Often"]
                }
            ]
        };

        let currentTest = null;
        let currentTestAnswers = [];

        // Utility functions
        function showAlert(elementId, message, type = 'error') {
            const alertDiv = document.getElementById(elementId);
            alertDiv.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
            setTimeout(() => {
                alertDiv.innerHTML = '';
            }, 5000);
        }

        function hideAllScreens() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('signupScreen').classList.add('hidden');
            document.getElementById('adminLoginScreen').classList.add('hidden');
            document.getElementById('patientDashboard').classList.add('hidden');
            document.getElementById('adminDashboard').classList.add('hidden');
        }

        function hideAllSections() {
            const sections = ['appointmentsSection', 'mentalHealthSection', 'healthRecordsSection', 'profileSection', 'testInterface'];
            sections.forEach(sectionId => {
                document.getElementById(sectionId).classList.add('hidden');
            });
        }

        function hideAllAdminSections() {
            const sections = ['adminAppointmentsSection', 'adminPatientsSection', 'adminTestResultsSection'];
            sections.forEach(sectionId => {
                document.getElementById(sectionId).classList.add('hidden');
            });
        }

        // Navigation functions
        function showLogin() {
            hideAllScreens();
            document.getElementById('loginScreen').classList.remove('hidden');
        }

        function showSignup() {
            hideAllScreens();
            document.getElementById('signupScreen').classList.remove('hidden');
        }

        function showAdminLogin() {
            hideAllScreens();
            document.getElementById('adminLoginScreen').classList.remove('hidden');
        }

        // Authentication functions
        function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            if (!email || !password) {
                showAlert('loginAlert', 'Please fill in all fields');
                return;
            }

            const patient = userData.patients.find(p => p.email === email && p.password === password);
            
            if (patient) {
                userData.currentUser = patient;
                userData.isAdmin = false;
                showPatientDashboard();
                showAlert('loginAlert', 'Login successful!', 'success');
            } else {
                showAlert('loginAlert', 'Invalid email or password');
            }
        }

        function signup() {
            const name = document.getElementById('signupName').value;
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            const phone = document.getElementById('signupPhone').value;
            const gender = document.getElementById('signupGender').value;

            if (!name || !email || !password || !phone || !gender) {
                showAlert('signupAlert', 'Please fill in all fields');
                return;
            }

            // Check if email already exists
            if (userData.patients.find(p => p.email === email)) {
                showAlert('signupAlert', 'Email already exists');
                return;
            }

            // Create new patient
            const newPatient = {
                id: userData.patients.length + 1,
                name,
                email,
                password,
                phone,
                gender
            };

            userData.patients.push(newPatient);
            showAlert('signupAlert', 'Account created successfully! You can now login.', 'success');
            
            setTimeout(() => {
                showLogin();
            }, 2000);
        }

        function adminLogin() {
            const username = document.getElementById('adminUsername').value;
            const password = document.getElementById('adminPassword').value;

            if (username === adminCredentials.username && password === adminCredentials.password) {
                userData.isAdmin = true;
                userData.currentUser = { name: 'Administrator', role: 'admin' };
                showAdminDashboard();
                showAlert('adminLoginAlert', 'Admin login successful!', 'success');
            } else {
                showAlert('adminLoginAlert', 'Invalid credentials');
            }
        }

        function logout() {
            userData.currentUser = null;
            userData.isAdmin = false;
            showLogin();
        }

        // Dashboard functions
        function showPatientDashboard() {
            hideAllScreens();
            document.getElementById('patientDashboard').classList.remove('hidden');
            loadAppointments();
            loadProfile();
        }

        function showAdminDashboard() {
            hideAllScreens();
            document.getElementById('adminDashboard').classList.remove('hidden');
            loadAdminAppointments();
            loadPatientsList();
            loadAdminTestResults();
        }

        function showSection(sectionName, event) {
            // Update sidebar active state
            const sidebarItems = document.querySelectorAll('#patientDashboard .sidebar li');
            sidebarItems.forEach(item => item.classList.remove('active'));
            if (event) event.target.classList.add('active');

            hideAllSections();
            document.getElementById(sectionName + 'Section').classList.remove('hidden');
        }

        function showAdminSection(sectionName, event) {
            // Update sidebar active state
            const sidebarItems = document.querySelectorAll('#adminDashboard .sidebar li');
            sidebarItems.forEach(item => item.classList.remove('active'));
            if (event) event.target.classList.add('active');

            hideAllAdminSections();
            document.getElementById('admin' + sectionName.charAt(0).toUpperCase() + sectionName.slice(1) + 'Section').classList.remove('hidden');
        }

        // Appointment functions
        function loadAppointments() {
            const appointmentsList = document.getElementById('appointmentsList');
            const userAppointments = userData.appointments.filter(apt => apt.patientId === userData.currentUser.id);
            
            if (userAppointments.length === 0) {
                appointmentsList.innerHTML = '<p>No appointments found. Book your first appointment below.</p>';
                return;
            }

            appointmentsList.innerHTML = userAppointments.map(apt => `
                <div class="appointment-card">
                    <h4>Appointment Request</h4>
                    <p><strong>Time:</strong> ${apt.time}</p>
                    <p><strong>Reason:</strong> ${apt.reason}</p>
                    <span class="appointment-status status-${apt.status}">${apt.status.toUpperCase()}</span>
                </div>
            `).join('');
        }

        function showBookingForm() {
            document.getElementById('bookingForm').classList.remove('hidden');
        }

        function hideBookingForm() {
            document.getElementById('bookingForm').classList.add('hidden');
            document.getElementById('appointmentTime').value = '';
            document.getElementById('appointmentReason').value = '';
        }

        function bookAppointment() {
            const time = document.getElementById('appointmentTime').value;
            const reason = document.getElementById('appointmentReason').value;

            if (!time || !reason) {
                alert('Please fill in all fields');
                return;
            }

            const newAppointment = {
                id: userData.appointments.length + 1,
                patientId: userData.currentUser.id,
                patientName: userData.currentUser.name,
                time: time,
                reason: reason,
                status: 'pending',
                date: new Date().toISOString()
            };

            userData.appointments.push(newAppointment);
            hideBookingForm();
            loadAppointments();
            alert('Appointment request submitted successfully!');
        }

        // Mental health test functions
        function startTest(testType) {
            currentTest = testType;
            currentTestAnswers = [];
            
            hideAllSections();
            document.getElementById('testInterface').classList.remove('hidden');
            
            const testTitle = document.getElementById('testTitle');
            const questionsDiv = document.getElementById('testQuestions');
            
            testTitle.textContent = `${testType.charAt(0).toUpperCase() + testType.slice(1)} Screening`;
            
            const questions = testQuestions[testType];
            questionsDiv.innerHTML = questions.map((q, index) => `
                <div class="question">
                    <h4>Question ${index + 1}: ${q.question}</h4>
                    <div class="radio-group">
                        ${q.options.map((option, optIndex) => `
                            <label class="radio-option">
                                <input type="radio" name="question${index}" value="${optIndex}">
                                ${option}
                            </label>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }

        function submitTest() {
            const questions = testQuestions[currentTest];
            const answers = [];
            let allAnswered = true;
            
            for (let i = 0; i < questions.length; i++) {
                const selectedOption = document.querySelector(`input[name="question${i}"]:checked`);
                if (selectedOption) {
                    answers.push(parseInt(selectedOption.value));
                } else {
                    allAnswered = false;
                    break;
                }
            }
            
            if (!allAnswered) {
                alert('Please answer all questions before submitting.');
                return;
            }
            
            const totalScore = answers.reduce((sum, score) => sum + score, 0);
            const maxScore = questions.length * (questions[0].options.length - 1);
            const percentage = Math.round((totalScore / maxScore) * 100);
            
            let interpretation = '';
            if (percentage < 25) {
                interpretation = 'Low severity - minimal symptoms detected';
            } else if (percentage < 50) {
                interpretation = 'Mild severity - some symptoms present';
            } else if (percentage < 75) {
                interpretation = 'Moderate severity - noticeable symptoms';
            } else {
                interpretation = 'High severity - significant symptoms detected';
            }
            
            const testResult = {
                id: userData.testResults.length + 1,
                patientId: userData.currentUser.id,
                patientName: userData.currentUser.name,
                testType: currentTest,
                score: totalScore,
                maxScore: maxScore,
                percentage: percentage,
                interpretation: interpretation,
                date: new Date().toISOString(),
                answers: answers
            };
            
            userData.testResults.push(testResult);
